{% extends "admin_base.html" %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block title %}Manage Payments - Cyber Bridge{% endblock title %} 

{% block content %}
    <main class="container-fluid my-5 px-4">
        
        <!-- Back link -->
        <a href="admin-dashboard.html" class="text-cyan back-link">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
        
        <!-- Page title -->
        <h1 class="page-title">Manage Payments</h1>
        <p class="page-subtitle">Track and manage all payment transactions on the platform.</p>
        
        <!-- Stats Row (4 cards) -->
        <div class="row mb-5">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card-stat card-stat-cyan">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="card-stat-number card-stat-number-cyan">₹0</div>
                            <div class="card-stat-label">Total Revenue</div>
                        </div>
                        <i class="bi bi-currency-rupee card-stat-icon card-stat-icon-cyan"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card-stat card-stat-success">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="card-stat-number card-stat-number-success">₹0</div>
                            <div class="card-stat-label">Completed</div>
                        </div>
                        <i class="bi bi-check-circle card-stat-icon card-stat-icon-success"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card-stat card-stat-warning">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="card-stat-number card-stat-number-warning">₹0</div>
                            <div class="card-stat-label">Pending</div>
                        </div>
                        <i class="bi bi-clock-history card-stat-icon card-stat-icon-warning"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card-stat card-stat-danger">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="card-stat-number card-stat-number-danger">₹0</div>
                            <div class="card-stat-label">Refunded</div>
                        </div>
                        <i class="bi bi-arrow-counterclockwise card-stat-icon card-stat-icon-danger"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Filter Section -->
        <div class="card-dark mb-4 p-2">
            <div class="row align-items-end">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Status</label>
                    <select class="form-select">
                        <option value="">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="pending">Pending</option>
                        <option value="refunded">Refunded</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Payment Type</label>
                    <select class="form-select">
                        <option value="">All Types</option>
                        <option value="complaint">Complaint Resolution</option>
                        <option value="session">Awareness Session</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Search</label>
                    <input type="text" class="form-input" placeholder="Search by transaction ID...">
                </div>
                <div class="col-md-2 mb-3">
                    <button class="button-primary full-width-button">
                        <i class="bi bi-search me-1"></i> Search
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Payments Table -->
        <div class="card-dark mb-4 p-2">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="section-heading">
                    <i class="bi bi-wallet2 me-2"></i>Hacker payables
                </h3>
                <button class="button-secondary">
                    <i class="bi bi-download me-1"></i> Export Report
                </button>
            </div>
            
            <div class="admin-table-wrapper">
                <table class="table-dark admin-table">
                    <thead>
                        <tr class="table-header">
                            <th class="table-header-cell">Transaction ID</th>
                            <th class="table-header-cell">From</th>
                            <th class="table-header-cell">To</th>
                            <th class="table-header-cell">Type</th>
                            <th class="table-header-cell">Amount</th>
                            <th class="table-header-cell">Date</th>
                            <th class="table-header-cell">Status</th>
                            <th class="table-header-cell">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for payout in hacker_payables %}
                    <tr class="table-row">
                        <td class="table-cell">
                            {{ payout.complaint.id }}
                        </td>

                        <td class="table-cell">
                            {{ payout.complaint.business.company_name }}
                        </td>

                        <td class="table-cell">
                            {{ payout.hacker.user.email }}
                        </td>

                        <td class="table-cell">
                            Complaint Resolution
                        </td>

                        <td class="table-cell">
                            ₹{{ payout.amount }}
                        </td>

                        <td class="table-cell">
                            {{ payout.completed_on|date:"d M Y" }}
                        </td>

                        <td class="table-cell">
                            <span class="badge bg-warning">Pending</span>
                        </td>

                        <td class="table-cell">
                            <a href="{% url "admin_hacker_payout" payout.id %}" class="button-primary btn-sm">
                                Pay Now
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">
                            No pending hacker payouts
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>

                </table>
            </div>
            
            <!-- Pagination -->
            <div class="d-flex justify-content-center mt-4 gap-2">
                <button class="button-secondary pagination-btn" disabled>
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="button-primary pagination-btn">1</button>
                <button class="button-secondary pagination-btn">2</button>
                <button class="button-secondary pagination-btn">3</button>
                <button class="button-secondary pagination-btn">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
        


        <div class="card-dark mb-4 p-2">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="section-heading">
                    <i class="bi bi-wallet2 me-2"></i>All Transaction
                </h3>
                <button class="button-secondary">
                    <i class="bi bi-download me-1"></i> Export Report
                </button>
            </div>
            
            <div class="admin-table-wrapper">
                <table class="table-dark admin-table">
                    <thead>
                        <tr class="table-header">
                            <th class="table-header-cell">Transaction ID</th>
                            <th class="table-header-cell">From</th>
                            <th class="table-header-cell">To</th>
                            <th class="table-header-cell">Type</th>
                            <th class="table-header-cell">Amount</th>
                            <th class="table-header-cell">Date</th>
                            <th class="table-header-cell">Status</th>
                            <th class="table-header-cell">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for txn in all_transactions %}
                    <tr class="table-row">
                        <td class="table-cell">{{ txn.id }}</td>

                        <td class="table-cell">
    {% if txn.payer.role_id == 2 %}
        {{ txn.payer.email }}
    {% else %}
        CyberBridge
    {% endif %}
</td>


                        <td class="table-cell">
    {% if txn.receiver.role_id == 1 %}
        {{ txn.receiver.email }}
    {% else %}
        CyberBridge
    {% endif %}
</td>


                        <td class="table-cell">
                            {% if txn.receiver and txn.receiver.role.name == "HACKER" %}
                                Hacker Payout
                            {% else %}
                                {{txn.paid_for}}
                            {% endif %}
                        </td>

                        <td class="table-cell">₹{{ txn.amount }}</td>

                        <td class="table-cell">{{ txn.date|date:"d M Y" }}</td>

                        <td class="table-cell">
                            {% if txn.status == "Paid" %}
                                <span class="badge bg-success">Paid</span>
                            {% elif txn.status == "Pending" %}
                                <span class="badge bg-warning">Pending</span>
                            {% elif txn.status == "Refunded" %}
                                <span class="badge bg-danger">Refunded</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ txn.status }}</span>
                            {% endif %}
                        </td>

                        <td class="table-cell">
                            <button class="button-secondary btn-sm">View</button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">
                            No transactions found
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>

                </table>
            </div>
            
            <!-- Pagination -->
            <div class="d-flex justify-content-center mt-4 gap-2">
                <button class="button-secondary pagination-btn" disabled>
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="button-primary pagination-btn">1</button>
                <button class="button-secondary pagination-btn">2</button>
                <button class="button-secondary pagination-btn">3</button>
                <button class="button-secondary pagination-btn">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>


        
        
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock content %}
